# ููุฎุต ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ ุนูู ูุดุฑูุน IPTV Smart Player

## ุชุงุฑูุฎ ุงูุฅุตูุงุญ
**ุงูุชุงุฑูุฎ:** 5 ููููุจุฑ 2025

---

## ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. ูุดููุฉ ุงูุจุซ ูุธู ูู ุญุงูุฉ Loading (ุชุญููู ูุณุชูุฑ) โ

#### ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

**ุงูููู:** `/client/src/components/VideoPlayer.tsx`

**ุงูุชุบููุฑุงุช:**
1. ุฅุถุงูุฉ `loadingTimeoutRef` ูุชุชุจุน timeout ุงูุชุญููู
2. ุฅุถุงูุฉ timeout ูุฏุชู 30 ุซุงููุฉ ููุชุญููู
3. ุฅุฐุง ูู ูุจุฏุฃ ุงูุจุซ ุฎูุงู 30 ุซุงููุฉุ ูุชู ุฅููุงู ุญุงูุฉ ุงูุชุญููู ูุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
4. ุชูุธูู timeout ุนูุฏ ูุฌุงุญ ุงูุชุญููู ูู ุงูุฃุญุฏุงุซ ุงูุชุงููุฉ:
   - `playing`: ุนูุฏูุง ูุจุฏุฃ ุงูููุฏูู ุจุงูุชุดุบูู
   - `canplay`: ุนูุฏูุง ูููู ุงูููุฏูู ุฌุงูุฒูุง ููุชุดุบูู
   - `loadeddata`: ุนูุฏูุง ูุชู ุชุญููู ุงูุจูุงูุงุช

**ุงูููุฏ ุงููุถุงู:**
```typescript
const loadingTimeoutRef = useRef<NodeJS.Timeout | null>(null);

// Set a maximum loading timeout of 30 seconds
if (loadingTimeoutRef.current) {
  clearTimeout(loadingTimeoutRef.current);
}
loadingTimeoutRef.current = setTimeout(() => {
  if (loading) {
    console.error('โฑ๏ธ Loading timeout after 30 seconds');
    setLoading(false);
    setError('Stream loading timeout. Please try again or select another channel.');
  }
}, 30000);
```

**ุงููุชูุฌุฉ:**
- ูู ูุธู ุงููุณุชุฎุฏู ุนุงูููุง ูู ุดุงุดุฉ ุงูุชุญููู ุฅูู ุงูุฃุจุฏ
- ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ ุชุธูุฑ ุจุนุฏ 30 ุซุงููุฉ
- ูููู ูููุณุชุฎุฏู ุงุฎุชูุงุฑ ููุงุฉ ุฃุฎุฑู ุฃู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู

---

### 2. ูุดููุฉ ุนุฏู ุธููุฑ ุงูุฃููุงู (VOD) ูุงููุณูุณูุงุช โ

#### ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

**ุงูููู:** `/client/src/contexts/XtreamContext.tsx`

**ุงูุชุบููุฑุงุช:**
1. ุฅุถุงูุฉ ุฏุงูุฉ `retryRequest` ูุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ ุนูุฏ ูุดู ุงูุทูุจุงุช
2. ุชุทุจูู retry logic ุนูู ุฌููุน ุทูุจุงุช ุชุญููู ุงูุจูุงูุงุช:
   - Categories: 3 ูุญุงููุงุช ูุน ุชุฃุฎูุฑ 2 ุซุงููุฉ
   - Live Channels: 2 ูุญุงููุฉ ูุน ุชุฃุฎูุฑ 3 ุซูุงูู
   - Movies: 2 ูุญุงููุฉ ูุน ุชุฃุฎูุฑ 3 ุซูุงูู
   - Series: 2 ูุญุงููุฉ ูุน ุชุฃุฎูุฑ 3 ุซูุงูู

**ุงูููุฏ ุงููุถุงู:**
```typescript
// Helper function to retry failed requests
const retryRequest = async <T,>(fn: () => Promise<T>, retries = 3, delay = 2000): Promise<T> => {
  for (let i = 0; i < retries; i++) {
    try {
      return await fn();
    } catch (err) {
      if (i === retries - 1) throw err;
      console.log(`๐ Retry attempt ${i + 1}/${retries} after ${delay}ms...`);
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
  throw new Error('Max retries reached');
};
```

**ุงููููุงุช:** `/client/src/pages/Movies.tsx`, `/client/src/pages/Series.tsx`, `/client/src/pages/LiveTV.tsx`

**ุงูุชุบููุฑุงุช:**
1. ุฅุถุงูุฉ ุนุฑุถ ุญุงูุฉ ุงูุชุญููู (`loading`) ูููุณุชุฎุฏู
2. ุฅุถุงูุฉ ุนุฑุถ ุฑุณุงุฆู ุงูุฎุทุฃ (`error`) ุจุดูู ูุงุถุญ
3. ุฅุถุงูุฉ ุฑุณุงูุฉ ุนูุฏูุง ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุงุญุฉ
4. ุงุณุชุฎุฏุงู `loading` ู `error` ูู XtreamContext

**ุงููุชูุฌุฉ:**
- ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ ุนูุฏ ูุดู ุชุญููู ุงูุจูุงูุงุช
- ุฑุณุงุฆู ูุงุถุญุฉ ูููุณุชุฎุฏู ุนู ุญุงูุฉ ุงูุชุญููู
- ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู ูุน feedback ูุงุถุญ

---

### 3. ูุดููุฉ ุงูุชุญุฏูุซ ุงูููุงุฌุฆ ูููููุน (Refresh) โ

#### ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ:

**ุงูููู:** `/client/src/contexts/XtreamContext.tsx`

**ุงูุชุบููุฑุงุช:**
1. ุฅุฒุงูุฉ `isAuthenticated` ูู ุชุจุนูุงุช `useEffect`
2. ูุฐุง ูููุน infinite loop ุงูุฐู ูุงู ูุญุฏุซ ุนูุฏูุง:
   - ูุชู ุชุญููู ุงูุจูุงูุงุช โ `setIsAuthenticated(true)`
   - ุชุชุบูุฑ `isAuthenticated` โ ูุนูุฏ ุชุดุบูู `useEffect`
   - ูุนูุฏ ุชุญููู ุงูุจูุงูุงุช โ `setIsAuthenticated(true)` ูุฑุฉ ุฃุฎุฑู
   - ูููุฐุง...

**ุงูููุฏ ูุจู ุงูุฅุตูุงุญ:**
```typescript
}, [currentUser?.uid, isAuthenticated]); // โ isAuthenticated ูุณุจุจ loop
```

**ุงูููุฏ ุจุนุฏ ุงูุฅุตูุงุญ:**
```typescript
}, [currentUser?.uid]); // โ ููุท currentUser?.uid
```

**ุงูุชุบููุฑุงุช ุงูุฅุถุงููุฉ:**
1. ุฅุฒุงูุฉ ูุชุบูุฑ `hasLoaded` ุบูุฑ ุงูุถุฑูุฑู
2. ุงูุงุนุชูุงุฏ ููุท ุนูู `isAuthenticated` ููุชุญูู ูู ุญุงูุฉ ุงููุตุงุฏูุฉ

**ุงููุชูุฌุฉ:**
- ูุง ูุฒูุฏ ูู ุงูุชุญุฏูุซ ุงูููุงุฌุฆ ูููููุน
- ุชุญููู ุงูุจูุงูุงุช ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ุฃุฏุงุก ุฃูุถู ูุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุซุฑ ุงุณุชูุฑุงุฑูุง

---

## ููุฎุต ุงูุชุญุณููุงุช

### ุงูููุซูููุฉ
- โ Timeout ููุชุญููู ูููุน ุงูุชุนููู ุงููุงููุงุฆู
- โ Retry logic ูุฒูุฏ ูู ูุฑุต ูุฌุงุญ ุชุญููู ุงูุจูุงูุงุช
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูู ุฌููุน ุงูุญุงูุงุช

### ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนู ุญุงูุฉ ุงูุชุญููู
- โ ุฑุณุงุฆู ุฎุทุฃ ูููููุฉ ููููุฏุฉ
- โ feedback ููุฑู ูููุณุชุฎุฏู
- โ ูุง ูุฒูุฏ ูู ุงูุชุญุฏูุซ ุงูููุงุฌุฆ

### ุงูุฃุฏุงุก
- โ ููุน infinite loops
- โ ุชุญููู ุงูุจูุงูุงุช ูุฑุฉ ูุงุญุฏุฉ ููุท
- โ ุชูุธูู ุฃูุถู ููููุงุฑุฏ (timeouts, refs)

---

## ุงููููุงุช ุงููุนุฏูุฉ

1. `/client/src/components/VideoPlayer.tsx` - ุฅุตูุงุญ ูุดููุฉ ุงูุชุญููู ุงููุณุชูุฑ
2. `/client/src/contexts/XtreamContext.tsx` - ุฅุตูุงุญ ูุดููุฉ ุงูุชุญุฏูุซ ูุฅุถุงูุฉ retry logic
3. `/client/src/pages/Movies.tsx` - ุชุญุณูู ุนุฑุถ ุงูุฃููุงู ูุงูุฑุณุงุฆู
4. `/client/src/pages/Series.tsx` - ุชุญุณูู ุนุฑุถ ุงููุณูุณูุงุช ูุงูุฑุณุงุฆู
5. `/client/src/pages/LiveTV.tsx` - ุชุญุณูู ุนุฑุถ ุงููููุงุช ูุงูุฑุณุงุฆู

---

## ุงูุชูุตูุงุช ููุงุณุชุฎุฏุงู

1. **ุงุฎุชุจุงุฑ ุงูุจุซ ุงููุจุงุดุฑ:**
   - ุชุฃูุฏ ูู ุฃู ุฑูุงุจุท ุงูุจุซ ุตุญูุญุฉ
   - ุชุญูู ูู ุฃู ุงูุฎุงุฏู ูุฏุนู CORS ุฃู ุงุณุชุฎุฏู proxy

2. **ุงุฎุชุจุงุฑ ุชุญููู ุงูุจูุงูุงุช:**
   - ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
   - ุชุฃูุฏ ูู ุตุญุฉ ุจูุงูุงุช ุงุนุชูุงุฏ Xtream Codes
   - ุฑุงูุจ console ููุญุตูู ุนูู ูุนูููุงุช ุงูุชุดุฎูุต

3. **ูู ุญุงูุฉ ุงููุดุงูู:**
   - ุงูุชุญ Developer Console (F12) ูุฑุคูุฉ ุงูุฃุฎุทุงุก
   - ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ุงููุนุฑูุถุฉ
   - ุฌุฑุจ ุชุญุฏูุซ ุงูุตูุญุฉ ุฃู ุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู

---

## ููุงุญุธุงุช ุชูููุฉ

### VideoPlayer
- ูุณุชุฎุฏู HLS.js ูุชุดุบูู ุงูุจุซ
- ูุฏุนู AirPlay ู Picture-in-Picture
- ูุฏุนู Low Latency Mode ููุจุซ ุงููุจุงุดุฑ
- Adaptive Bitrate Streaming (ABR) ุชููุงุฆู

### XtreamContext
- ูุฏูุฑ ุญุงูุฉ ุงููุตุงุฏูุฉ ูุงูุจูุงูุงุช
- ูุญูุธ ุจูุงูุงุช ุงูุงุนุชูุงุฏ ูู Firestore
- ูุญูู ุงูุจูุงูุงุช ุชููุงุฆููุง ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
- ูุฏุนู Retry Logic ููููุซูููุฉ

### API Integration
- ูุณุชุฎุฏู Xtream Codes API
- ูุฏุนู Proxy ูุชุฌูุจ ูุดุงูู CORS
- Timeout 20 ุซุงููุฉ ููุทูุจุงุช
- ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

---

## ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ุฌููุน ุงููุดุงูู ุงููุจูุบ ุนููุง ุจูุฌุงุญ:
1. โ ุงูุจุซ ูู ูุธู ูู ุญุงูุฉ loading ููุฃุจุฏ
2. โ ุงูุฃููุงู ูุงููุณูุณูุงุช ุณุชุธูุฑ ุจุดูู ุฃูุถู ูุน retry logic
3. โ ูุง ูุฒูุฏ ูู ุงูุชุญุฏูุซ ุงูููุงุฌุฆ ูููููุน

ุงููุดุฑูุน ุงูุขู ุฃูุซุฑ ุงุณุชูุฑุงุฑูุง ูููุซูููุฉ ูุณูููุฉ ูู ุงูุงุณุชุฎุฏุงู.
