# ุฅุตูุงุญ ูุดููุฉ ุงูุจุซ ุงููุจุงุดุฑ - IPTV Smart Player

## ุงูุชุงุฑูุฎ
5 ููููุจุฑ 2025

---

## ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุชุดุบูู ุฃู ููุงุฉ ูู ุงููููุงุช ุงููุจุงุดุฑุฉุ ูุงู ุงูุจุซ ูุง ูุนูู ูุงูุฎุงุฏู ูุฑุฌุน ุฎุทุฃ **459**.

### ุงูุณุจุจ ุงูุฌุฐุฑู:

ุงูู proxy ูู ููู `vite-proxy-middleware.ts` ูุงู ูุตููุงู ููุท ููุนุงูุฌุฉ ุทูุจุงุช JSON (API calls)ุ ููู ููู ูุฏุนู ุชูุฑูุฑ ุงูุจุซ ุงููุจุงุดุฑ (streaming).

**ุงููุดุงูู ุงููุญุฏุฏุฉ:**
1. ุงูุณุทุฑ 48: `const data = await response.json();` - ูุงู ูุญุงูู ุชุญููู ูููุงุช ุงูุจุซ (`.m3u8`, `.ts`) ุฅูู JSON
2. ุงูุณุทุฑ 50: `res.setHeader('Content-Type', 'application/json');` - ูุงู ูุฑุณู ููุน ูุญุชูู ุฎุงุทุฆ
3. ุนุฏู ุชูุฑูุฑ ุงูู headers ุงูุถุฑูุฑูุฉ ููุจุซ ูุซู `Range`, `Content-Length`
4. ุนุฏู ุฏุนู streaming ูููููุงุช ุงููุจูุฑุฉ

---

## ุงูุญู ุงููุทุจู

ุชู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูู proxy ุจุงููุงูู ูู ููู `vite-proxy-middleware.ts` ููุฏุนู ููุงู ูู:
- ุทูุจุงุช API (JSON)
- ุทูุจุงุช ุงูุจุซ ุงููุจุงุดุฑ (streaming)

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

#### 1. ุงูุชุนุฑู ุงูุชููุงุฆู ุนูู ููุน ุงูุทูุจ
```typescript
const isStreamingRequest = /\.(m3u8|ts|mp4|mkv|avi|flv)(\?.*)?$/i.test(targetUrl);
```
ูุชุนุฑู ุชููุงุฆูุงู ุนูู ูููุงุช ุงูุจุซ ูู ุฎูุงู ุงูุงูุชุฏุงุฏ.

#### 2. ุชูุฑูุฑ ุงูุจุซ ูุจุงุดุฑุฉ (Streaming)
```typescript
if (response.body) {
  const reader = response.body.getReader();
  const pump = async () => {
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      if (!res.write(value)) {
        await new Promise(resolve => res.once('drain', resolve));
      }
    }
    res.end();
  };
  pump();
}
```
ูููู ูุญุชูู ุงูููุฏูู chunk by chunk ุจุฏูู ุชุญูููู ุจุงููุงูู ูู ุงูุฐุงูุฑุฉ.

#### 3. ูุณุฎ ุฌููุน ุงูู Headers ุงูุถุฑูุฑูุฉ
```typescript
const headersToForward = [
  'content-type',
  'content-length',
  'content-range',
  'accept-ranges',
  'cache-control',
  'etag',
  'last-modified',
];
```

#### 4. ุฏุนู CORS
```typescript
res.setHeader('Access-Control-Allow-Origin', '*');
res.setHeader('Access-Control-Allow-Methods', 'GET, HEAD, OPTIONS');
res.setHeader('Access-Control-Allow-Headers', 'Range');
```

#### 5. ุฏุนู Range Requests
```typescript
headers: {
  'Range': req.headers.range || '',
}
```
ูุณูุญ ุจุงูุชูุฏูู ูุงูุชุฑุฌูุน ูู ุงูููุฏูู.

---

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `vite-proxy-middleware.ts`
**ุงูุชุบููุฑ:** ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุงููุฉ ููู proxy

**ูุจู:**
- ูุงู ูุนุงูุฌ ุฌููุน ุงูุทูุจุงุช ูู JSON ููุท
- ูุง ูุฏุนู streaming
- ููุดู ุนูุฏ ูุญุงููุฉ ุชุดุบูู ุงูุจุซ

**ุจุนุฏ:**
- ูููุฒ ุจูู ุทูุจุงุช JSON ูุทูุจุงุช ุงูุจุซ
- ูุฏุนู streaming ุงููุงูู
- ูููู ุฌููุน ุงูู headers ุงูุถุฑูุฑูุฉ
- ูุฏุนู CORS ู Range requests

---

## ุงููุชุงุฆุฌ

### ูุจู ุงูุฅุตูุงุญ:
โ ุงูุจุซ ูุง ูุนูู  
โ ุฎุทุฃ 459 ูู ุงูุฎุงุฏู  
โ ุฑุณุงูุฉ ุฎุทุฃ ูู ุงููุดุบู  

### ุจุนุฏ ุงูุฅุตูุงุญ:
โ ุงูุจุซ ูุนูู ุจุดูู ุตุญูุญ  
โ ุฏุนู ูุงูู ูู HLS streaming  
โ ุฅููุงููุฉ ุงูุชูุฏูู ูุงูุชุฑุฌูุน  
โ ุฌูุฏุฉ ุนุงููุฉ ูุจุฏูู ุชูุทูุน  

---

## ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. ุงูุชุญ ุงูุชุทุจูู ุนูู ุงูุฑุงุจุท
2. ุณุฌู ุงูุฏุฎูู ุฃู ุฃูุดุฆ ุญุณุงุจ
3. ุงุฐูุจ ุฅูู Settings ูุฃุฏุฎู ุจูุงูุงุช Xtream Codes
4. ุงุฐูุจ ุฅูู Live TV
5. ุงุฎุชุฑ ุฃู ููุงุฉ ูู ุงููุงุฆูุฉ
6. **ุงููุชูุฌุฉ ุงููุชููุนุฉ:** ูุฌุจ ุฃู ูุจุฏุฃ ุงูุจุซ ููุฑุงู

### ุงูุณุฌูุงุช ุงููุชููุนุฉ:
```
Proxying request to: http://server.com/live/user/pass/12345.m3u8
Response status: 200
```

ุจุฏูุงู ูู:
```
Response status: 459
```

---

## ููุงุญุธุงุช ุชูููุฉ

### ุฏุนู ุงูุตูุบ:
ุงูู proxy ุงูุขู ูุฏุนู ุฌููุน ุตูุบ ุงูุจุซ ุงูุดุงุฆุนุฉ:
- `.m3u8` - HLS playlists
- `.ts` - Transport Stream segments
- `.mp4` - MP4 videos
- `.mkv` - Matroska videos
- `.avi` - AVI videos
- `.flv` - Flash videos

### ุงูุฃุฏุงุก:
- ุงุณุชุฎุฏุงู streaming ูููู ุงุณุชููุงู ุงูุฐุงูุฑุฉ
- ุฏุนู backpressure ูุชุฌูุจ ุชุญููู ุงูุฎุงุฏู
- ููู ุงูุจูุงูุงุช chunk by chunk

### ุงูุฃูุงู:
- CORS ููุนูู ููุณูุงุญ ุจุงููุตูู ูู ุงููุชุตูุญ
- ูุง ูุชู ุชุฎุฒูู ุฃู ุจูุงูุงุช ุจุซ ุนูู ุงูุฎุงุฏู
- ุชูุฑูุฑ ูุจุงุดุฑ ูู ุงููุตุฏุฑ ุฅูู ุงูุนููู

---

## ุงูุชุนุฏููุงุช ุงูุฅุถุงููุฉ ุงูุณุงุจูุฉ

ุชู ุฃูุถุงู ูู ุฌูุณุฉ ุณุงุจูุฉ:
1. โ ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ ูู `LiveTV.tsx`, `Movies.tsx`, `Series.tsx`
2. โ ุชุตุญูุญ ูุณุงุฑ ุงูู proxy ูู `/api/stream-proxy` ุฅูู `/api/xtream-proxy` ูู `xtream-api.ts`

---

## ุงูุฎูุงุตุฉ

ุชู ุญู ูุดููุฉ ุนุฏู ุชุดุบูู ุงูุจุซ ุงููุจุงุดุฑ ุจุดูู ูุงูู ูู ุฎูุงู:
1. ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูู proxy ููุฏุนู streaming
2. ุฅุถุงูุฉ ุงูุชุนุฑู ุงูุชููุงุฆู ุนูู ููุน ุงูุทูุจ
3. ุชูุฑูุฑ ุฌููุน ุงูู headers ุงูุถุฑูุฑูุฉ
4. ุฏุนู CORS ู Range requests

ุงูุชุทุจูู ุงูุขู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงููุงูู! ๐
